@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>项目维护</title>
    <link href="~/Scripts/jquery-easyui-1.4.4/themes/bootstrap/easyui.css" rel="stylesheet" />
    <script src="~/Scripts/jquery-easyui-1.4.4/jquery.min.js"></script>
    <script src="~/Scripts/jquery-easyui-1.4.4/jquery.easyui.min.js"></script>
    <script src="~/Scripts/jquery-easyui-1.4.4/locale/easyui-lang-zh_CN.js"></script>
    <link href="~/Content/themes/icon.css" rel="stylesheet" />
    <script src="~/Content/js/common.js"></script>
    <link href="~/Content/themes/table.css" rel="stylesheet" />
    <script type="text/javascript">
        $(function () {
            $.ajax({     //请求当前用户可以操作的按钮
                url: "/Button/GetUserAuthorizeButton?r=" + Math.random(),
                type: "post",
                data: { "KeyCode": "PMMaintain", "KeyName": "PMMaintain" },
                dataType: "json",
                timeout: 5000,
                success: function (data) {
                    if (data.success) {
                        var toolbar = getToolBar(data);      //common.js
                        if (data.search) {     //判断是否有浏览权限
                            var oldSelectRoleId;   //上次点选的RoleId
                            $("#ui_role_dg").datagrid({       //初始化datagrid
                                url: "/Project/GetAllPMInfo",
                                striped: true, rownumbers: true, pagination: true, pageSize: 20, singleSelect: true,
                                idField: 'Id',
                                sortName: 'UpdateTime',
                                sortOrder: 'asc',
                                pageList: [20, 40, 60, 80, 100],
                                frozenColumns: [[
                                              
                                                 {
                                                     width: '100',
                                                     title: '项目编码',
                                                     field: 'ProjectNo',
                                                     formatter: function (value, row, index) {
                                                         return value.length > 8 ? '<span title="' + value + '">' + value + '</span>' : value;
                                                     }
                                                 },
                                                 {
                                                     width: '100',
                                                     title: '项目名称',
                                                     field: 'ProjectName',
                                                     formatter: function (value, row, index) {
                                                         return value.length > 8 ? '<span title="' + value + '">' + value + '</span>' : value;
                                                     }
                                                 }

                                ]],
                                columns: [[
                                     { field: 'ProjectClerk', title: '业务员', sortable: true, width: 130 },

                                           { field: 'UpdateTime', title: '最后更新时间', sortable: true, width: 130 },
                                           { field: 'UpdateBy', title: '最后更新人', width: 130 },
                                             { field: 'CreateBy', title: '创建时间', sortable: true, width: 130 },
                                { field: 'CreateTime', title: '创建人', width: 130 },
                                           {
                                               field: 'Remark', title: '项目说明', width: 300,
                                               formatter: function (value, row, index) {
                                                   return value.length > 20 ? '<span title="' + value + '">' + value + '</span>' : value;
                                               }
                                           }]],
                                toolbar: toolbar.length == 0 ? null : toolbar,
                                onSelect: function (rowIndex, rowData) {
                                    if (oldSelectRoleId == rowData.Id) {
                                        return;
                                    }
                                    oldSelectRoleId = rowData.Id;
                                    var $ui_role_layout = $("#ui_role_layout");
                                    var eastRoleUser = $ui_role_layout.layout("panel", "east");
                                    if (eastRoleUser.panel("options").collapsed) {   //判断是否展开
                                        $ui_role_layout.layout("expand", "east");
                                    }
                                    eastRoleUser.panel("setTitle", rowData.RoleName + "成员");
                                    if ($("#ui_role_user_dg").data("datagrid")) {
                                        $("#ui_role_user_dg").datagrid({       //请求数据
                                            url: "/Role/GetRoleUserByRoleId?roleId=" + rowData.Id
                                        });
                                    }
                                    else {
                                        $("#ui_role_user_dg").datagrid({       //初始化datagrid
                                            url: "/Role/GetRoleUserByRoleId?roleId=" + rowData.Id,
                                            striped: true, rownumbers: true, pagination: true, pageSize: 20, singleSelect: true,
                                            idField: 'ID',
                                            sortName: 'CreateTime',
                                            sortOrder: 'asc',
                                            pageList: [20, 40, 60, 80, 100],
                                            columns: [[
                                                  { field: 'AccountName', title: '登录名', sortable: true, width: 100 },
                                                  { field: 'RealName', title: '姓名', sortable: true, width: 80 },
                                                  {
                                                      field: 'IsAble', title: '启用', sortable: true, width: 60, align: 'center',
                                                      formatter: function (value, row, index) {
                                                          if (value != null) {
                                                              return value ? '<img src="../Content/themes/icon/chk_checked.gif" alt="已启用" title="用户已启用" />' : '<img src="../Content/themes/icon/chk_unchecked.gif" alt="未启用" title="用户未启用" />';
                                                          }
                                                      }
                                                  },
                                                  {
                                                      field: 'IfChangePwd', title: '改密', sortable: true, width: 60, align: 'center',
                                                      formatter: function (value, row, index) {
                                                          if (value != null) {
                                                              return value ? '<img src="../Content/themes/icon/chk_checked.gif" alt="已改密" title="用户已改密" />' : '<img src="../Content/themes/icon/chk_unchecked.gif" alt="未改密" title="用户未改密" />';
                                                          }
                                                      }
                                                  },
                                                  { field: 'CreateTime', title: '添加时间', sortable: true, width: 130 }]]
                                        });
                                    }
                                }
                            });
                        }
                        else {
                            $.show_alert("提示", "无权限，请联系管理员！");
                        }
                    } else {
                        $.show_alert("错误", data.result);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    if (textStatus == "timeout") {
                        $.show_alert("提示", "请求超时，请刷新当前页重试！");
                    }
                    else {
                        $.show_alert("错误", textStatus + "：" + errorThrown);
                    }
                }
            })
        });


    </script>
        </head>
        <body>
            <div id="ui_user_layout" class="easyui-layout" data-options="fit:true,border:false">
                <div data-options="region:'north',split:true,border:true,collapsed:false" title="搜索条件" style="height:104px;">
                    <div id="ui_pm_search">
                        <table class="tableForm" style="width: 99%; height: 100%; background: #F5F5F5;">
                            <tr>
                                <th>
                                    项目编码：
                                </th>
                                <td>
                                    <input name="txtPMId" id="txtPMId" class="easyui-validatebox textbox" style="width:150px;height:22px;" />
                                </td>

                                <th>
                                    项目名称：
                                </th>
                                <td>
                                    <input name="txtPMName" id="txtPMName" class="easyui-validatebox textbox" style="width:150px;height:22px;" />
                                </td>

                             
 
                            <tr>
                                <th>
                                    添加时间：
                                </th>
                                <td>
                                    <input name="txtAddBeginDate" id="txtAddBeginDate" class="easyui-datetimebox"
        editable="false" style="width:150px;height:22px;" />
</td>

<th>
 至：
</th>
<td>
 <input name="txtAddEndDate" id="txtAddEndDate" class="easyui-datetimebox"
        editable="false" style="width:150px;height:22px;" />
</td>
<td colspan="4">
    <a href="javascript:void(0);" class="easyui-linkbutton" iconcls="icon-search" plain="true"
        onclick="ui_user_searchdata();">搜索</a>
     <a href="javascript:void(0);" class="easyui-linkbutton" iconcls="icon-clear" plain="true"
        onclick="ui_user_cleardata();">清空条件</a>
 </td>
</tr>
</table>
</div>
</div>
<div data-options="region:'center',border:false">
    <table id="ui_user_dg" data-options="fit:true,border:false"></table>
</div>
</div>
</body>
</html>
